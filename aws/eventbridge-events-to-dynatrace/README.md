# Send AWS EventBridge events to Dynatrace

This folder contains AWS CloudFormation templates to set up forwarding of events from [Amazon EventBridge](https://aws.amazon.com/eventbridge/) to Dynatrace with two possible ingestion mechanisms:

* [Business Events](https://docs.dynatrace.com/docs/platform-modules/business-analytics/apps/explore-business-events) (formatted as [CloudEvents](https://cloudevents.io/))
* [Log](https://docs.dynatrace.com/docs/observe-and-explore/logs) events

To ingest events from your event-driven applications containing business data, use Business Events (bizevents) ingestion. For AWS infrastructure events and similar use cases, use log ingestion.

## Ingest as BizEvents

The provided CloudFormation template creates an Eventbridge rule configured with an [Input Transformer](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-transform-target-input.html) to format the Eventbridge events as CloudEvents as documented by AWS [here](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-transform-target-input.html).

The example AWS CLI command below creates an EventBridge Rule that ingests events of type `Object Created` generated by `aws.s3` in the default event bus to Dynatrace as BizEvents:

```bash
aws cloudformation deploy --stack-name eventbridge-to-dynatrace-bizevents \
    --template-file biz-events.yaml \
    --capabilities CAPABILITY_IAM \
    --parameter-overrides \
        pDynatraceEnvironmentUrl=https://abc12345.live.dynatrace.com \
        pDynatraceAccessToken=your_access_token_here \
        pEventSources="aws.s3" \
        pEventDetailTypes="Object Created" 
```

> [!NOTE]
> To create the rule on a different Event Bus, add the parameter `pEventBridgeBusName` with the name of your event bus.

To query events in Dynatrace, you can use the example [DQL](https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language) query below:

```custom
fetch bizevents
| filter matchesValue(event.provider,"aws.s3")
```

## Ingest as Logs

The provided CloudFormation template creates an Eventbridge rule configured with an [Input Transformer](https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-transform-target-input.html) to format the log events with the following attributes:

```json
{
    "timestamp": <event time>,
    "aws.account.id": <AWS Account Id>,
    "log.source": <Event Source>,
    "aws.region": <AWS Region>,
    "aws.service": "eventbridge",
    "content": <EventBridge event object>,
}
```

The example AWS CLI command below creates an EventBridge Rule that ingests events of type `Object Created`  generated by `aws.s3` in the default event bus to Dynatrace as Log events:

```bash
aws cloudformation deploy --stack-name eventbridge-to-dynatrace-logs \
    --template-file logs.yaml \
    --capabilities CAPABILITY_IAM \
    --parameter-overrides \
        pDynatraceEnvironmentUrl=https://abc12345.live.dynatrace.com \
        pDynatraceAccessToken=your_access_token_here \
        pEventSources="aws.s3" \
        pEventDetailTypes="Object Created" 
```

> [!NOTE]
> To create the rule on a different Event Bus, add the parameter `pEventBridgeBusName` with the name of your event bus.

To query events in Dynatrace, you can use the [DQL](https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language) query below:

```custom
fetch logs
| filter matchesValue(aws.service,"eventbridge")
```

To set up alerts based on the occurrence of specific events, check the Log Management and Analytics [documentation](https://docs.dynatrace.com/docs/observe-and-explore/logs/lma-use-cases/lma-e2e-set-log-alert).
